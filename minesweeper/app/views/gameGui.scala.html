@(controller:de.htwg.se.minesweeper.controller.controller.Controller, gameState: String)

@import helper._
@import de.htwg.se.minesweeper.model.Symbols

@main("Minesweeper GUI") {
    <link rel="stylesheet" href="@routes.Assets.versioned("stylesheets/main.css")">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon-32x32.png">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="@routes.Assets.versioned("javascripts/main.js")"></script>

    <!-- Video-Hintergrund -->
    <div id="video-background">
        <video autoplay loop muted playsinline>
            <source src="../assets/Minesweeper.mp4" type="video/mp4">
            Ihr Browser unterst√ºtzt das Video-Tag nicht.
        </video>
    </div>

    <!-- Graue Leiste oben -->
    <header>
        <nav id="top-nav">
            <a href="@routes.HomeController.gameHomepage()" id="logo">Minesweeper</a>
        </nav>
    </header>

    <!-- Hauptinhalt f√ºr das Spiel -->
    <div id="content" class="@gameState">
        <div id="difficulty">
            <button id="easy" class="btn-custom mx-2">Easy</button>
            <button id="medium" class="btn-custom mx-2">Medium</button>
            <button id="hard" class="btn-custom mx-2">Hard</button>
        </div>

        <script>
            const gameState = "@gameState";

            let gameOverHandled = false;

            if ((gameState === "Lost" || gameState === "Won") && !gameOverHandled) {
                displayBombs();
                gameOverHandled = true;
            }
        </script>

        <!-- Brennende "You Lost"-Meldung anzeigen, wenn das Spiel verloren ist -->
        @if(gameState == "Lost") {
            <div id="you-lost">
                <img src="../assets/you_lost.png" alt="You Lost" class="lost-image" />
            </div>
        }

        <div id="gameBoard">
            @for(y <- 0 until controller.field.size) {
                <div class="game-row">
                    @for(x <- 0 until controller.field.size) {
                        <div class="cell covered" data-x="@y" data-y="@x"
                            onclick="uncoverCell(@y, @x)"
                            oncontextmenu="flagCell(@y, @x); return false;">
                            <span class="cell-content">
                                @{
                                    controller.field.cell(x, y) match {
                                        case Symbols.Covered => Html("")
                                        case Symbols.Flag => Html("üö©")
                                        case Symbols.Bomb => Html(s"""<img src="${routes.Assets.versioned("assets/Mine.png")}" alt="Mine" class="mine-icon">""")
                                        case Symbols.Empty => Html("&nbsp;")
                                        case number => Html(number.toString)
                                    }
                                }
                            </span>
                        </div>
                    }
                </div>
            }
        </div>

        <div id="controls">
            <button id='undo' class="btn-custom mx-2">Undo</button>
            <button id='restart' class="btn-custom mx-2">Restart</button>
            <button id='saveGame' class="btn-custom mx-2">Save Game</button>
            <button id='loadGamePage' class="btn-custom mx-2">Load Game</button>
        </div>
    </div>

    <!-- JavaScript-Funktion f√ºr die Explosion und Neustart -->
    <script>
        function explodeAndRestart() {
            const youLostElement = document.getElementById('you-lost');
            if (youLostElement) {
                youLostElement.classList.add('explode');
                setTimeout(() => {
                    window.location.href = '@routes.HomeController.restart()';
                }, 1000); // Wartezeit f√ºr die Explosion
            } else {
                window.location.href = '@routes.HomeController.restart()';
            }
        }
    </script>
}
